# I-Compass (校内マップシステム)

市川学園文化祭向けのインタラクティブな校内マップ＆ナビゲーションシステムです。
文化祭や学校案内などで、来場者が目的の教室や施設を簡単に見つけられるように設計されています。

## 特徴

### 🗺️ マップ機能 (Visitor Mode)
*   **全フロア統合表示**: 1階〜5階をシームレスに切り替え・表示。
*   **高度な検索機能**:
    *   **キーワード検索**: 部屋名、企画名などの部分一致検索。
    *   **カテゴリフィルター**: トイレ、自販機、教室など種別ごとの絞り込み。
    *   **優先ソート**: 主要なスポット（エントランス、ホール等）を上位に表示。
*   **ナビゲーション**:
    *   現在地から目的地までの最短ルートを自動計算（ダイクストラ法）。
    *   階をまたぐ移動（階段・エレベーター）に対応。
    *   ステップバイステップのルート案内表示。
*   **UI/UX**:
    *   モバイルファーストなレスポンシブデザイン。
    *   コンパス（羅針盤）をモチーフにしたモダンでプレミアムなデザインテーマ。
    *   スムーズなズーム＆パン操作 (D3.js).

### 🛠️ エディタ機能 (Admin Mode)
`editor.html` からマップデータの作成・編集が可能です。
*   **ノード編集**: 部屋、廊下、階段などのポイントを追加・移動・削除。
*   **メタデータ管理**: 部屋名に加え、文化祭の**企画名**や展示団体名も登録可能。
*   **接続管理**: ノード間をリンクして経路ネットワークを構築。
*   **JSON入出力**: 編集データをJSON形式で保存・読み込み。

## 動作環境

本システムはモダンブラウザ（Chrome, Safari, Edge, Firefox）で動作します。
ES Modules (`import/export`) および `fetch` API を使用しているため、ローカルで動作させる場合は簡易的なWebサーバーが必要です。

### ローカルでの起動方法 (例: Python)

```bash
# プロジェクトリポジトリに移動
cd school-map

# HTTPサーバーを起動
python -m http.server 8000

# ブラウザでアクセス
# マップ: http://localhost:8000/map.html
# エディタ: http://localhost:8000/editor.html
```

## ファイル構成

*   `map.html`: 一般利用者向けマップ画面
*   `editor.html`: 管理者向けマップデータ編集画面
*   `assets/`: 静的リソース
    *   `js/`: アプリケーションロジック (`map-core.js`, `ui-controller.js` 等)
    *   `css/`: スタイルシート
*   `JSON/`: フロアごとのマップデータ (`1.json` 〜 `5.json`) および設定ファイル (`order.json`)
*   `images/`: フロア図面画像

## 技術仕様 (Technical Details)

本システムは外部ライブラリの依存を最小限に抑え、軽量かつ高速に動作するように設計されています。

### 1. アーキテクチャ
*   **MapEngine (`map-core.js`)**:
    *   地図の描画（D3.js）、フロアデータの読み込み、座標変換、経路探索アルゴリズムの中核を担います。
    *   各フロアの座標系を統合し、全階層を単一のグラフネットワークとして扱います。
*   **UIController (`ui-controller.js`)**:
    *   ユーザーインターフェース（検索ボックス、ドロップダウン、現在地・目的地の選択）を管理します。
    *   ユーザーの入力を受け取り、MapEngineのAPIを呼び出して経路を描画させます。
*   **Configuration (`config.js`)**:
    *   フロア構成、画像パス、座標オフセットなどの設定を集約し、コードの変更なしでマップ定義を変更可能です。

### 2. 経路探索アルゴリズム
*   **ダイクストラ法 (Dijkstra's Algorithm)**: 指定された「現在地」から「目的地」までの最短経路を計算します。
*   **Ghost Graph (仮想統合グラフ)**:
    *   各フロアのマップデータ (`1.json`～`5.json`) は独立していますが、ロード時に `MapEngine` がこれらを統合します。
    *   階段やエレベーターなど、同じ名称（例: "階段A"）を持つノード同士は、自動的に仮想的なエッジ（重み付きリンク）で接続されます。
    *   これにより、ユーザーは階数を意識することなく、「1階の入口」から「3階の教室」へのルートを一回の計算で導き出せます。

### 3. データ構造 (JSON)
マップデータは独自のJSONフォーマットで管理されています。

```json
{
  "nodes": [
    {
      "id": 1709...,
      "x": 100, "y": 200,
      "type": "room",   // room, toilet, stairs, elevator, etc.
      "name": "3-A",    // 表示名
      "eventName": "お化け屋敷", // (任意) 企画名
      "floorId": 3      // (自動付与)
    }
  ],
  "edges": [
    { "from": 1709..., "to": 1710..., "dist": 50 }
  ]
}
```

### 4. カスタマイズ
*   **表示順序 (`order.json`)**: ドロップダウンリスト内での表示優先順位を定義します。部分一致により、特定のキーワード（例: "自販機"）を含む施設の表示順を制御できます。
*   **スタイル (`style.css`)**: CSS変数 (`:root`) を使用しており、テーマカラー（メイン、アクセント、背景色）を簡単に変更可能です。

## Copyright

&copy; 2026 市川学園 & Junxiang Jin. All rights reserved.
