<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>I-Compass</title>

    <!-- Fonts (Loaded via style.css @import) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" href="data:,">
</head>

<body>
    <!-- Opening Animation Overlay -->
    <div id="opening-overlay">
        <div class="opening-content">
            <div class="compass-logo-large">
                <div class="compass-needle-large"></div>
            </div>
            <h1 class="opening-title">I-Compass</h1>
            <div class="opening-status">システム起動中...</div>
        </div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="header-row">
                    <h1 class="logo-text">I-Compass</h1>
                    <button id="sidebar-close-btn" class="icon-btn mobile-only">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
                            <path
                                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                        </svg>
                    </button>
                </div>
                <div class="floor-tabs" id="floor-tabs">
                    <!-- Javascript will populate buttons here -->
                </div>
            </div>

            <div class="search-panel">
                <div class="control-group">
                    <label class="control-label">出発地</label>
                    <!-- Custom Select Container -->
                    <div class="custom-select" id="custom-start-select">
                        <div class="select-trigger" tabindex="0">
                            <span class="selection-text">出発地を選択...</span>
                            <div class="arrow"></div>
                        </div>
                        <div class="select-options">
                            <!-- JS Populated -->
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">目的地</label>
                    <div class="custom-select" id="custom-end-select">
                        <div class="select-trigger" tabindex="0">
                            <span class="selection-text">目的地を選択...</span>
                            <div class="arrow"></div>
                        </div>
                        <div class="select-options">
                            <!-- JS Populated -->
                        </div>
                    </div>
                </div>

                <div class="route-container">
                    <label class="control-label">ナビゲーションルート</label>
                    <ul class="route-list" id="route-list">
                        <!-- Route steps will appear here -->
                    </ul>
                </div>
            </div>
        </div>
        <div class="sidebar-footer">
            &copy; 2026 市川学園 & Junxiang Jin. All rights reserved.
        </div>

        <!-- Map Area -->
        <div class="map-container" id="map-wrapper">
            <canvas id="mapCanvas"></canvas>

            <!-- Controls -->
            <div class="map-controls">
                <button class="control-btn" id="fit-map" title="全体表示">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                        <path d="M5 5h5v2H7v3H5V5zm10 0h5v5h-2V7h-3V5zm0 14h3v-3h2v5h-5v-2zM5 14h2v3h3v2H5v-5z" />
                    </svg>
                </button>
                <button class="control-btn" id="zoom-in" title="拡大">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                </button>
                <button class="control-btn" id="zoom-out" title="縮小">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                        <path d="M19 13H5v-2h14v2z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Mobile: Menu Button to open Sidebar -->
        <button id="mobile-menu-btn" class="mobile-fab box-shadow">
            <!-- Search Icon -->
            <svg viewBox="0 0 24 24" width="28" height="28" fill="white">
                <path
                    d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
            </svg>
        </button>

        <!-- Mobile: Route Overlay (Top-Right) -->
        <div id="mobile-route-overlay" class="mobile-overlay hidden">
            <div class="overlay-header">
                <span class="header-title">ルート案内</span>
                <button id="overlay-toggle-btn" class="overlay-toggle">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="white">
                        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
                    </svg>
                </button>
            </div>
            <div id="mobile-route-content"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div>マップデータを読み込み中...</div>
    </div>

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/map-core.js"></script>
    <script src="assets/js/ui-controller.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Init App
            const engine = new MapEngine('mapCanvas', 'map-wrapper');
            window.ui = new UIController(engine);

            // Check URL params for floor
            const params = new URLSearchParams(window.location.search);
            const floor = params.get('floor');
            if (floor) {
                window.ui.switchFloor(parseInt(floor));
            }
        });
    </script>
</body>

</html>