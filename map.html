<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>I-Compass</title>

    <!-- Fonts (Loaded via style.css @import) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
</head>

<body>
    <!-- Opening Animation Overlay -->
    <div id="opening-overlay">
        <div class="opening-content">
            <div class="compass-logo-large">
                <div class="compass-needle-large"></div>
            </div>
            <h1 class="opening-title">I-Compass</h1>
            <div class="opening-status">システム起動中...</div>
        </div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo-text">I-Compass</h1>
                <div class="floor-tabs" id="floor-tabs">
                    <!-- Javascript will populate buttons here -->
                </div>
            </div>

            <div class="search-panel">
                <div class="control-group">
                    <label class="control-label">出発地</label>
                    <!-- Custom Select Container -->
                    <div class="custom-select" id="custom-start-select">
                        <div class="select-trigger" tabindex="0">
                            <span class="selection-text">出発地を選択...</span>
                            <div class="arrow"></div>
                        </div>
                        <div class="select-options">
                            <!-- JS Populated -->
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">目的地</label>
                    <div class="custom-select" id="custom-end-select">
                        <div class="select-trigger" tabindex="0">
                            <span class="selection-text">目的地を選択...</span>
                            <div class="arrow"></div>
                        </div>
                        <div class="select-options">
                            <!-- JS Populated -->
                        </div>
                    </div>
                </div>

                <div class="route-container">
                    <label class="control-label">ナビゲーションルート</label>
                    <ul class="route-list" id="route-list">
                        <!-- Route steps will appear here -->
                    </ul>
                </div>
            </div>

            <div class="sidebar-footer">
                &copy; 2026 市川学園 & Junxiang Jin. All rights reserved.
            </div>
        </div>

        <!-- Map Area -->
        <div class="map-container" id="map-wrapper">
            <canvas id="mapCanvas"></canvas>

            <!-- Controls -->
            <div class="map-controls">
                <button class="control-btn" id="fit-map" title="全体表示">⛶</button>
                <button class="control-btn" id="zoom-in" title="拡大">＋</button>
                <button class="control-btn" id="zoom-out" title="縮小">－</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div>マップデータを読み込み中...</div>
    </div>

    <!-- Scripts -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/map-core.js"></script>
    <script src="assets/js/ui-controller.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Init App
            const engine = new MapEngine('mapCanvas', 'map-wrapper');
            window.ui = new UIController(engine);

            // Check URL params for floor
            const params = new URLSearchParams(window.location.search);
            const floor = params.get('floor');
            if (floor) {
                window.ui.switchFloor(parseInt(floor));
            }
        });
    </script>
</body>

</html>